<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Añadir Nuevo Apartamento</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <header class="container-fluid">
    <%- include('./partials/header.ejs') %>
  </header>

  <main class="container">
    <h1><%= editMode ? "Editar" : "Añadir" %> Apartamento</h1>

    <form action="/admin/apartment/<%= editMode ? apartment._id + '/edit' : 'add-new' %>" method="post">

      <!-- Información general -->
      <label for="title">Título</label>
      <input type="text" name="title" id="title" required maxlength="40" value="<%= apartment.title || '' %>" />

      <label for="description">Descripción</label>
      <textarea name="description" id="description"><%= apartment.description || '' %></textarea>

      <label for="rules">Reglas del apartamento</label>
      <textarea name="rules" id="rules"><%= apartment.rules || '' %></textarea>

      <!-- Distribución -->
      <label for="rooms">Habitaciones</label>
      <input type="number" name="rooms" id="rooms" value="<%= apartment.rooms || 0 %>" />

      <label for="beds">Camas</label>
      <input type="number" name="beds" id="beds" value="<%= apartment.beds || 0 %>" />

      <label for="bathrooms">Baños</label>
      <input type="number" name="bathrooms" id="bathrooms" value="<%= apartment.bathrooms || 0 %>" />

      <!-- Precio y dimensiones -->
      <label for="price">Precio por noche (€)</label>
      <input type="number" name="price" id="price" required value="<%= apartment.price || '' %>" />

      <label for="squareMeters">Superficie (m²)</label>
      <input type="number" name="squareMeters" id="squareMeters" required value="<%= apartment.squareMeters || '' %>" />

      <label for="maxGuests">Capacidad máxima de huéspedes</label>
      <input type="number" name="maxGuests" id="maxGuests" value="<%= apartment.maxGuests || '' %>" />

      <!-- Ubicación -->
      <label for="province">Provincia</label>
      <input type="text" name="province" id="province" value="<%= apartment.location?.province || '' %>" />

      <label for="city">Ciudad</label>
      <input type="text" name="city" id="city" required value="<%= apartment.location?.city || apartment.city || '' %>" />

      <label for="gpsLat">Latitud (GPS)</label>
      <input type="number" name="gpsLat" step="any" id="gpsLat" value="<%= apartment.location?.gps?.lat || '' %>" />

      <label for="gpsLng">Longitud (GPS)</label>
      <input type="number" name="gpsLng" step="any" id="gpsLng" value="<%= apartment.location?.gps?.lng || '' %>" />

      <label for="mapLink">Enlace a Google Maps</label>
      <input type="url" name="mapLink" id="mapLink" value="<%= apartment.location?.mapLink || '' %>" />

      <!-- Fotos -->
      <h3>Fotos del apartamento (máx. 4)</h3>
      <% for (let i = 0; i < 4; i++) { %>
        <fieldset>
          <legend>Foto <%= i + 1 %></legend>

          <label for="photos[<%= i %>][url]">URL:</label>
          <input type="url" name="photos[<%= i %>][url]" value="<%= apartment.photos?.[i]?.url || '' %>" />

          <label for="photos[<%= i %>][description]">Descripción:</label>
          <input type="text" name="photos[<%= i %>][description]" value="<%= apartment.photos?.[i]?.description || '' %>" />

          <label>
            <input type="checkbox" name="photos[<%= i %>][isMain]" value="true"
              <%= apartment.photos?.[i]?.isMain ? 'checked' : '' %> />
            ¿Es la foto principal?
          </label>
        </fieldset>
      <% } %>

      <!-- Servicios -->
      <h3>Servicios incluidos</h3>
      <% const s = apartment.services || {}; %>
      <label><input type="checkbox" name="services[wifi]" <%= s.wifi ? "checked" : "" %>> Wifi</label><br />
      <label><input type="checkbox" name="services[parking]" <%= s.parking ? "checked" : "" %>> Parking</label><br />
      <label><input type="checkbox" name="services[disability]" <%= s.disability ? "checked" : "" %>> Acceso movilidad reducida</label><br />
      <label><input type="checkbox" name="services[airConditioning]" <%= s.airConditioning ? "checked" : "" %>> Aire acondicionado</label><br />
      <label><input type="checkbox" name="services[heating]" <%= s.heating ? "checked" : "" %>> Calefacción</label><br />
      <label><input type="checkbox" name="services[tv]" <%= s.tv ? "checked" : "" %>> Televisión</label><br />
      <label><input type="checkbox" name="services[kitchen]" <%= s.kitchen ? "checked" : "" %>> Cocina</label><br />
      <label><input type="checkbox" name="services[internet]" <%= s.internet ? "checked" : "" %>> Internet</label><br />

      <!-- Botón de envío -->
      <input type="submit" value="<%= editMode ? 'Actualizar' : 'Añadir' %>" />
    </form>

    <% if (editMode) { %>
      <section id="modal">
        <button class="contrast btn--danger" data-target="modal-example" onclick="toggleModal(event)">
          Eliminar Apartamento
        </button>
      </section>
    <% } %>
  </main>

  <!-- Modal de confirmación de borrado -->
  <dialog id="modal-example">
    <article>
      <header>
        <button aria-label="Close" rel="prev" data-target="modal-example" onclick="toggleModal(event)"></button>
        <h3>¿Seguro que quieres eliminar el apartamento?</h3>
      </header>
      <p>Los apartamentos eliminados no se pueden recuperar.</p>
      <footer style="display: flex; justify-content: space-between;">
        <button role="button" class="secondary" data-target="modal-example" onclick="toggleModal(event)">
          Cancelar
        </button>
        <form action="/admin/apartment/<%= apartment._id %>/delete" method="post">
          <input role="button" class="btn--danger" type="submit" value="Confirmar" />
        </form>
      </footer>
    </article>
  </dialog>

  <script src="/modal.js"></script>
</body>

</html>
