<!DOCTYPE html>
<html lang="es">

<head>
    <title>Book Joy</title>
    <%- include('./partials/head.ejs') %>
</head>

<body>
    <header class="container-fluid py-3 bg-dark text-white">
        <%- include('./partials/header.ejs') %>
    </header>

    <main class="container my-5">

        <!-- Filtro de búsqueda -->
        <section class="mb-5">
            <h1 class="text-center mb-4">Reserva tu apartamento en Book Joy</h1>

            <form action="/search" method="get" class="row g-3 justify-content-center">
                <div class="col-md-3">
                    <label class="form-label">Ciudad</label>
                    <input type="text" class="form-control" name="city" value="<%= filters.city || '' %>">
                </div>

                <div class="col-md-2">
                    <label class="form-label">Capacidad mínima</label>
                    <input type="number" class="form-control" name="maxGuests" min="1"
                        value="<%= filters.maxGuests || '' %>">
                </div>

                <div class="col-md-2">
                    <label class="form-label">Entrada</label>
                    <input type="date" class="form-control" name="startDate" value="<%= filters.startDate || '' %>">
                </div>

                <div class="col-md-2">
                    <label class="form-label">Salida</label>
                    <input type="date" class="form-control" name="endDate" value="<%= filters.endDate || '' %>">
                </div>

                <div class="col-md-2">
                    <label class="form-label">Precio máximo (€)</label>
                    <input type="number" class="form-control" name="maxPrice" required
                        value="<%= filters.maxPrice || '' %>">
                </div>

                <div class="col-12 text-center mt-3">
                    <button type="submit" class="btn btn-primary px-4">Buscar</button>
                </div>
            </form>
        </section>

        <!-- Grid de apartamentos -->
        <section class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            <% allApartments.forEach(function(apt) { const mainPhoto=apt.photos?.find(p=> p.isMain) || apt.photos?.[0]
                || {};
                %>
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <img src="<%= mainPhoto.url || '/placeholder.jpg' %>" class="card-img-top"
                            alt="<%= apt.title %>">

                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">
                                <%= apt.title %>
                            </h5>
                            <p class="card-text mb-1"><strong>Precio:</strong> €<%= apt.price %> / noche</p>
                            <p class="card-text mb-1"><strong>Superficie:</strong>
                                <%= apt.squareMeters %> m²
                            </p>
                            <p class="card-text mb-2"><strong>Capacidad:</strong>
                                <%= apt.maxGuests %> personas
                            </p>

                            <%# Íconos de los servicios %>
                            <div class="servicios d-flex flex-wrap gap-3">

                                    <% if (apt.services?.wifi) { %>
                                        <span title="Wi-Fi"><i class="fa-solid fa-wifi"></i></span>
                                        <% } %>

                                            <% if (apt.services?.parking) { %>
                                                <span title="Parking"><i class="fa-solid fa-square-parking"></i></span>
                                                <% } %>

                                                    <% if (apt.services?.disability) { %>
                                                        <span title="Accesible"><i class="fa-brands fa-accessible-icon"></i></span>
                                                        <% } %>

                                                            <% if (apt.services?.airConditioning) { %>
                                                                <span title="Aire acondicionado"><i class="fa-solid fa-snowflake"></i></span>
                                                                <% } %>

                                                                    <% if (apt.services?.heating) { %>
                                                                        <span title="Calefacción"><i class="fa-solid fa-snowflake"></i></span>
                                                                        <% } %>

                                                                            <% if (apt.services?.tv) { %>
                                                                                <span title="Televisión"><i class="fa-solid fa-tv"></i></span>
                                                                                <% } %>

                                                                                    <% if (apt.services?.kitchen) { %>
                                                                                        <span title="Cocina"><i class="fa-solid fa-kitchen-set"></i></span>
                                                                                        <% } %>

                                                                                            <% if
                                                                                                (apt.services?.internet)
                                                                                                { %>
                                                                                                <span
                                                                                                    title="Internet"><i class="fa-solid fa-globe"></i></span>
                                                                                                <% } %>
                                </div>

                                <a href="/apartment/<%= apt._id %>" class="btn btn-outline-primary mt-auto">Ver
                                    detalles</a>
                        </div>
                    </div>
                </div>
                <% }); %>
        </section>

    </main>
</body>

</html>