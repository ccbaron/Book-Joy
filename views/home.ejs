<!DOCTYPE html>
<html lang="es">

<head>
    <title>Book Joy</title>
    <%- include('./partials/head.ejs') %>
</head>

<body>
    <header class="container-fluid py-3 bg-dark text-white">
        <%- include('./partials/header.ejs') %>
    </header>

    <main class="container my-5">

        <!-- Filtro de búsqueda -->
        <section class="mb-5">
            <h1 class="text-center mb-4">Reserva tu apartamento en Book Joy</h1>

            <form action="/search" method="get" class="row g-3 mb-4">

                <!-- Huéspedes (capacidad mínima) -->
                <div class="col-12 col-sm-6 col-md-3">
                    <label for="guests" class="form-label">Huéspedes</label>
                    <input type="number" min="1" name="guests" id="guests" class="form-control"
                        value="<%= filters?.guests || '' %>">
                </div>

                <!-- Ciudad -->
                <div class="col-12 col-sm-6 col-md-3">
                    <label for="city" class="form-label">Ciudad</label>
                    <input type="text" name="city" id="city" class="form-control" value="<%= filters?.city || '' %>">
                </div>

                <!-- Fechas -->

                <!-- Fecha de entrada -->
                <div class="col-md-3">
                    <label for="startDate" class="form-label">Fecha de entrada</label>
                    <input type="date" class="form-control" name="startDate" id="startDate">
                </div>

                <!-- Fecha de salida -->
                <div class="col-md-3">
                    <label for="endDate" class="form-label">Fecha de salida</label>
                    <input type="date" class="form-control" name="endDate" id="endDate">
                </div>

                <!-- Precio -->
                <div class="col-12 col-sm-6 col-md-3">
                    <label for="minPrice" class="form-label">Precio mínimo</label>
                    <input type="number" min="0" name="minPrice" id="minPrice" class="form-control"
                        value="<%= filters?.minPrice || '' %>">
                </div>
                <div class="col-12 col-sm-6 col-md-3">
                    <label for="maxPrice" class="form-label">Precio máximo</label>
                    <input type="number" min="0" name="maxPrice" id="maxPrice" class="form-control"
                        value="<%= filters?.maxPrice || '' %>">
                </div>

                <!-- Ordenar -->
                <div class="col-12 col-sm-6 col-md-3">
                    <label for="sort" class="form-label">Ordenar por</label>
                    <select name="sort" id="sort" class="form-select">
                        <option value="">-- Sin orden --</option>
                        <option value="price_asc" <%=filters?.sort==='price_asc' ? 'selected' : '' %>>Precio ↑</option>
                        <option value="price_desc" <%=filters?.sort==='price_desc' ? 'selected' : '' %>>Precio ↓
                        </option>
                        <option value="m2_asc" <%=filters?.sort==='m2_asc' ? 'selected' : '' %>>m² ↑</option>
                        <option value="m2_desc" <%=filters?.sort==='m2_desc' ? 'selected' : '' %>>m² ↓</option>
                    </select>
                </div>

                <div class="col-12 col-sm-6 col-md-3 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Buscar</button>
                </div>
            </form>

        </section>

        <!-- Grid de apartamentos -->
        <section class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            <% allApartments.forEach(function(apt) { const mainPhoto=apt.photos?.find(p=> p.isMain) || apt.photos?.[0]
                || {};
                %>
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <img src="<%= mainPhoto.url || '/placeholder.jpg' %>" class="card-img-top"
                            alt="<%= apt.title %>">

                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">
                                <%= apt.title %>
                            </h5>
                            <p class="card-text mb-1"><strong>Precio:</strong> €<%= apt.price %> / noche</p>
                            <p class="card-text mb-1"><strong>Superficie:</strong>
                                <%= apt.squareMeters %> m²
                            </p>
                            <p class="card-text mb-2"><strong>Capacidad:</strong>
                                <%= apt.maxGuests %> personas
                            </p>

                            <%# Íconos de los servicios %>
                                <div class="d-flex flex-wrap gap-3 text-dark mt-3 mb-3">

                                    <% if (apt.services?.wifi) { %>
                                        <span title="Wi-Fi"><i class="fa-solid fa-wifi"></i></span>
                                        <% } %>

                                            <% if (apt.services?.parking) { %>
                                                <span title="Parking"><i class="fa-solid fa-square-parking"></i></span>
                                                <% } %>

                                                    <% if (apt.services?.disability) { %>
                                                        <span title="Accesible"><i
                                                                class="fa-brands fa-accessible-icon"></i></span>
                                                        <% } %>

                                                            <% if (apt.services?.airConditioning) { %>
                                                                <span title="Aire acondicionado"><i
                                                                        class="fa-solid fa-snowflake"></i></span>
                                                                <% } %>

                                                                    <% if (apt.services?.heating) { %>
                                                                        <span title="Calefacción"><i
                                                                                class="fa-solid fa-fire-flame-curved"></i></span>
                                                                        <% } %>

                                                                            <% if (apt.services?.tv) { %>
                                                                                <span title="Televisión"><i
                                                                                        class="fa-solid fa-tv"></i></span>
                                                                                <% } %>

                                                                                    <% if (apt.services?.kitchen) { %>
                                                                                        <span title="Cocina"><i
                                                                                                class="fa-solid fa-kitchen-set"></i></span>
                                                                                        <% } %>

                                                                                            <% if
                                                                                                (apt.services?.internet)
                                                                                                { %>
                                                                                                <span
                                                                                                    title="Internet"><i
                                                                                                        class="fa-solid fa-globe"></i></span>
                                                                                                <% } %>
                                </div>

                                <a href="/apartment/<%= apt._id %>" class="btn btn-outline-primary mt-auto">Ver
                                    detalles</a>
                        </div>
                    </div>
                </div>
                <% }); %>
        </section>

    </main>
</body>

</html>